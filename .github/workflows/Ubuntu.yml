name: Headless Go + Tailscale

on:
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-22.04
    timeout-minutes: 360

    env:
      USERNAME: "dolvin"
      PASSWORD: "whatsapp2"
      TALESCALE_AUTH_KEY: ${{ secrets.TALESCALE_AUTH_KEY }}

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      - name: Prepare System
        run: |
          sudo apt update -y
          sudo apt upgrade -y
          sudo apt install -y git wget curl nano sudo

      - name: Create User (Optional)
        run: |
          sudo useradd -m -s /bin/bash "$USERNAME" || true
          echo "$USERNAME:$PASSWORD" | sudo chpasswd
          sudo usermod -aG sudo "$USERNAME" || true

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh

      - name: Start Tailscale (Normal Kernel Mode âœ…)
        run: |
          sudo tailscaled & sleep 3Â Â 
Â Â Â Â Â     Â sudo tailscale up --authkey="${{ env.TALESCALE_AUTH_KEY }}" --hostname=runner-${{ github.run_id }}Â Â Â Â 
          tailscale ip -4
          
          

      - name: Keep Alive (Prevent Runner From Ending)
        run: |
          echo "âœ… Connected via Tailscale"
          echo "â¡ï¸  View node in your Tailscale dashboard"
          echo "ğŸ›‘ To stop: Cancel workflow manually."
          while true; do sleep 300; done
