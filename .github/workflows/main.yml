name: Kali SSH

on:
  workflow_dispatch:

jobs:
  kali:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - name: Update & Install Kali tools
        run: |
          sudo apt update
          sudo apt install -y kali-linux-headless

      - name: Install Desktop (optional)
        run: |
          sudo apt install -y xfce4 xrdp
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Create User
        run: |
          sudo useradd -m kali
          echo "kali:Kali123!@" | sudo chpasswd
          sudo usermod -aG sudo kali

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=kali-${{ github.run_id }}

      - name: Show Access Info
        run: |
          echo "======================================"
          echo "User       : kali"
          echo "Password   : Kali123!@"
          echo "SSH / RDP IP (Tailscale):"
          tailscale ip -4
          echo "======================================"

      - name: Keep Alive
        run: |
          while true; do 
            echo "Kali Linux active..."
            sleep 300
          done
